<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page - World Cup 2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="./styles/style.css">
</head>
<body>
    <h1>Admin Page - World Cup 2026</h1>

    <!-- Authentication Form -->
    <div id="auth-container">
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="Enter email" required>
        <br>
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Enter password" required>
        <br>
        <button id="login-button">Login</button>
        <p id="auth-error" style="color: red; display: none;">Invalid email or password.</p>
    </div>

    <!-- Admin Content -->
    <div id="admin-content" style="display: none;">
        <!-- Dropdown for groups -->
        <label for="group-select">Select Group:</label>
        <select id="group-select">
            <option value="">-- Select a Group --</option>
        </select>

        <!-- Teams list -->
        <div id="teams-container" style="margin-top: 20px;">
            <!-- Teams will be dynamically displayed here -->
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBxdeTLscpv1RK8W7SabyJJckYiBjLQRvM",
            authDomain: "world-cup-2026-b1fda.firebaseapp.com",
            projectId: "world-cup-2026-b1fda",
            storageBucket: "world-cup-2026-b1fda.firebasestorage.app",
            messagingSenderId: "355932893733",
            appId: "1:355932893733:web:cb338ea08dc12705bf05cc",
            measurementId: "G-6QWWJLC2LM"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Handle login
        document.getElementById('login-button').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    // Hide authentication form and show admin content
                    document.getElementById('auth-container').style.display = 'none';
                    document.getElementById('admin-content').style.display = 'block';

                    // Fetch groups
                    fetchGroups();
                })
                .catch(err => {
                    console.error('Error during login:', err);
                    document.getElementById('auth-error').style.display = 'block';
                });
        });

        // Fetch all groups and populate the dropdown
        function fetchGroups() {
            db.collection('groups').get()
                .then(groupsSnapshot => {
                    const groups = groupsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    populateGroupDropdown(groups);
                })
                .catch(err => {
                    console.error('Error fetching groups:', err);
                });
        }

        // Populate the dropdown with groups
        function populateGroupDropdown(groups) {
            const groupSelect = document.getElementById('group-select');
            groups.forEach(group => {
                if (group.name) {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = group.name;
                    groupSelect.appendChild(option);
                }
            });

            // Add event listener for group selection
            groupSelect.addEventListener('change', (event) => {
                const selectedGroupId = event.target.value;
                if (selectedGroupId) {
                    const selectedGroup = groups.find(group => group.id === selectedGroupId);
                    displayTeams(selectedGroup);
                } else {
                    document.getElementById('teams-container').innerHTML = ''; // Clear teams list
                }
            });
        }

        // Display teams for the selected group
        function displayTeams(group) {
            const teamsContainer = document.getElementById('teams-container');
            teamsContainer.innerHTML = ''; // Clear previous teams

            if (group.teams && typeof group.teams === 'object') {
                Object.entries(group.teams).forEach(([teamId, team]) => {
                    const teamDiv = document.createElement('div');
                    teamDiv.style.marginBottom = '20px';

                    teamDiv.innerHTML = `
                        <label>Team Name:</label>
                        <input type="text" id="name-${teamId}" value="${team.Name || ''}" style="margin-right: 10px;">
                        <label>Matches Played:</label>
                        <input type="number" id="matches-${teamId}" value="${team.Played || 0}" style="margin-right: 10px;">
                        <button onclick="updateTeam('${group.id}', '${teamId}')">Update</button>
                    `;

                    teamsContainer.appendChild(teamDiv);
                });
            } else {
                teamsContainer.innerHTML = '<p>No teams found for this group.</p>';
            }
        }

        // Update team data in Firestore
        function updateTeam(groupId, teamId) {
    const nameInput = document.getElementById(`name-${teamId}`);
    const matchesInput = document.getElementById(`matches-${teamId}`);

    const updatedData = {
        Name: nameInput.value,
        Played: parseInt(matchesInput.value, 10)
    };

    // Use Firestore's update method to update only the specified fields
    db.collection('groups').doc(groupId).update({
        [`teams.${teamId}.Name`]: updatedData.Name,
        [`teams.${teamId}.Played`]: updatedData.Played
    })
    .then(() => {
        alert('Team updated successfully!');
    })
    .catch(err => {
        console.error('Error updating team:', err);
        alert('Failed to update team. Please try again.');
    });
}
    </script>
</body>
</html>